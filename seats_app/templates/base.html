{% load static %}
<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reserve your workstation seat at Workspace+ with ease.">
    <meta name="keywords" content="Nayatel, Workspace, Seat Reservation, Office Booking, Desk Booking, PWA">
    <meta name="author" content="PRYSM Technologies">

    <!-- Open Graph / Social -->
    <meta property="og:title" content="Workspace+ Seat Reservation">
    <meta property="og:description" content="Book your workspace seat quickly and securely.">
    <meta property="og:image" content="{% static 'images/workspace-plus-logo.png' %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://workspaceplus.com">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Workspace+ Seat Reservation">
    <meta name="twitter:description" content="Book your workspace seat quickly and securely.">
    <meta name="twitter:image" content="{% static 'images/wsp.png' %}">

    <!-- PWA / Installable -->
    <link rel="manifest" href="{% static 'manifest.json' %}">
    <meta name="theme-color" content="#1e293b">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Workspace+">
    <link rel="apple-touch-icon" href="{% static 'images/wsp.png' %}">

    <title>{% block title %}Workspace+{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="{% static 'images/wsp.ico' %}">

    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Gradient text for headings */
      .text-gradient {
        background: linear-gradient(90deg, #3b82f6, #8b5cf6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      /* Toast animation */
      @keyframes slide-down {
        from { opacity: 0; transform: translateY(-15px); }
        to { opacity: 1; transform: translateY(0); }
      }
      .animate-slide-down { animation: slide-down 0.3s ease-out; }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-gray-900/90 backdrop-blur-md border-b border-gray-800 shadow-md">
  <div class="container mx-auto px-4 sm:px-6 py-2 flex justify-between items-center">

    <!-- Logo -->
    <a href="{% url 'seats:index' %}" class="flex items-center">
      <img src="{% static 'images/workspace-plus-logo.png' %}" alt="Logo" class="w-[180px] h-auto object-contain">
    </a>

    <!-- Mobile menu button -->
    <div class="sm:hidden">
      <button id="mobile-menu-btn" class="text-gray-200 hover:text-white focus:outline-none">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </div>

    <!-- Desktop Auth Section -->
    <div class="hidden sm:flex items-center gap-2 sm:gap-3">
      {% if user.is_authenticated %}
        <div class="flex items-center gap-2">

          {% if user.is_superuser %}
          <!-- Admin Dropdown -->
          <div class="relative" id="admin-dropdown">
            <button class="flex items-center gap-2 bg-white/10 backdrop-blur-sm px-3 py-1 rounded-lg hover:bg-white/20 transition">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm font-medium">{{ user.username }}</span>
              <svg id="admin-arrow" class="w-3 h-3 mt-1 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
              </svg>
            </button>
            <div id="admin-menu" class="absolute right-0 mt-2 w-40 bg-gray-800 text-gray-100 rounded-lg shadow-lg hidden">
              <a href="{% url 'seats:admin_map' %}" class="block px-4 py-2 hover:bg-gray-700">Seat Map</a>
            </div>
          </div>
          {% else %}
          <!-- Regular User -->
          <div class="hidden sm:flex items-center gap-2 bg-white/10 backdrop-blur-sm px-3 py-1 rounded-lg">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
            </svg>
            <span class="text-sm font-medium">{{ user.username }}</span>
          </div>
          {% endif %}

          <!-- Logout -->
          <a href="{% url 'logout' %}" 
             class="flex items-center gap-1.5 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all hover:scale-105 shadow">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/>
            </svg>
            <span class="hidden sm:inline">Logout</span>
          </a>

        </div>
      {% else %}
        <a href="{% url 'login' %}" class="flex items-center gap-1.5 hover:bg-white/10 px-3 py-1 rounded-lg text-sm font-medium transition">Login</a>
        <a href="{% url 'register' %}" class="flex items-center gap-1.5 bg-gradient-to-r from-blue-500 to-purple-600 text-white px-3 py-1 rounded-lg text-sm font-semibold hover:from-blue-600 hover:to-purple-700 transition-all shadow">Register</a>
      {% endif %}
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="sm:hidden hidden mt-2 px-4 pb-2 space-y-2 text-gray-200">
    {% if user.is_authenticated %}
    <a href="#" class="block px-3 py-2 text-white transition">{{ request.user.username}}</a>
      {% if user.is_superuser %}
        <a href="{% url 'seats:admin_map' %}" class="block px-3 py-2 rounded-lg hover:bg-gray-800 transition">Seat Map</a>
      {% endif %}
      <a href="{% url 'logout' %}" class="block px-3 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white transition">Logout</a>
    {% else %}
      <a href="{% url 'login' %}" class="block px-3 py-2 rounded-lg hover:bg-gray-800 transition">Login</a>
      <a href="{% url 'register' %}" class="block px-3 py-2 rounded-lg bg-gradient-to-r from-blue-500 to-purple-600 text-white hover:from-blue-600 hover:to-purple-700 transition">Register</a>
    {% endif %}
  </div>
</nav>

<!-- Main Content -->
<main class="flex-1 container mx-auto px-4 py-6">
  {% block content %}{% endblock %}
</main>

<!-- Footer -->
<footer class="bg-gray-900/90 backdrop-blur-sm border-t border-gray-800 mt-auto">
  <div class="container mx-auto px-4 py-4 flex flex-col sm:flex-row justify-between items-center gap-2 text-sm text-gray-400">
    <div class="flex items-center gap-2">
      <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z"/>
      </svg>
      <span>&copy; {{ now|date:"Y" }} Workspace+ | PRYSM Technologies </span>
    </div>
  </div>
</footer>

<!-- Scripts -->
<script>
  // Toggle Mobile Menu
  const mobileBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  mobileBtn.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

  // Toggle Admin Dropdown
  const adminBtn = document.querySelector('#admin-dropdown button');
  const adminMenu = document.getElementById('admin-menu');
  const adminArrow = document.getElementById('admin-arrow');
  if(adminBtn) {
    adminBtn.addEventListener('click', () => {
      adminMenu.classList.toggle('hidden');
      adminArrow.classList.toggle('rotate-180');
    });
    document.addEventListener('click', e => {
      if (!document.getElementById('admin-dropdown').contains(e.target)) {
        adminMenu.classList.add('hidden');
        adminArrow.classList.remove('rotate-180');
      }
    });
  }

  // Toast helpers
  function showToast(message, type="info") {
    const colors = { success:"bg-green-600", error:"bg-red-600", info:"bg-blue-600", warning:"bg-yellow-500" };
    let container = document.getElementById("toast-container");
    if(!container){
      container = document.createElement("div");
      container.id="toast-container";
      container.className="fixed top-5 left-1/2 transform -translate-x-1/2 z-[9999] flex flex-col items-center space-y-2";
      document.body.appendChild(container);
    }
    const toast = document.createElement("div");
    toast.className=`text-white text-sm px-4 py-2 rounded-lg shadow-lg max-w-xs text-center ${colors[type]||colors.info} animate-slide-down`;
    toast.textContent = message;
    container.appendChild(toast);
    setTimeout(() => { toast.classList.add("opacity-0","-translate-y-2"); setTimeout(()=>toast.remove(),400); }, 2500);
  }

  function getCookie(name){
    const value = document.cookie.match("(^|;)\\s*" + name + "\\s*=\\s*([^;]+)");
    return value ? value.pop() : "";
  }
  const csrftoken = getCookie("csrftoken");



  if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register("{% static 'sw.js' %}")
    .then(reg => console.log("SW registered: ", reg))
    .catch(err => console.log("SW registration failed: ", err));
  });
}
</script>



</body>
</html>
